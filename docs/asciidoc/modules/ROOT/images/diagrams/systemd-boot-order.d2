# systemd Service Dependencies for 802.1X

direction: down

# Clean vertical flow
device: sys-subsystem-net-devices-eth0.device {
  shape: rectangle
  style: {
    fill: "#607d8b"
    font-color: white
    bold: true
    border-radius: 4
  }
}

wpa: wpa_supplicant-wired@eth0 {
  shape: rectangle
  style: {
    fill: "#1565c0"
    font-color: white
    bold: true
    border-radius: 4
  }
}

dhcp: dhcpcd@eth0 {
  shape: rectangle
  style: {
    fill: "#388e3c"
    font-color: white
    bold: true
    border-radius: 4
  }
}

network_target: network.target {
  shape: rectangle
  style: {
    fill: "#e65100"
    font-color: white
    bold: true
    border-radius: 4
  }
}

online_target: network-online.target {
  shape: rectangle
  style: {
    fill: "#ff8f00"
    font-color: white
    bold: true
    border-radius: 4
  }
}

# Dependency chain
device -> wpa: "Requires, After" {
  style: {
    stroke: "#1565c0"
    stroke-width: 2
  }
}

wpa -> dhcp: "After (port authorized)" {
  style: {
    stroke: "#388e3c"
    stroke-width: 2
  }
}

dhcp -> network_target: "Before" {
  style: {
    stroke: "#e65100"
    stroke-width: 2
  }
}

network_target -> online_target: "Before" {
  style: {
    stroke: "#ff8f00"
    stroke-width: 2
  }
}

# Conflict - positioned to the side
iwd: iwd.service (MASKED) {
  shape: rectangle
  style: {
    fill: "#c62828"
    font-color: white
    bold: true
    border-radius: 4
  }
}

wpa -> iwd: "Conflicts" {
  style: {
    stroke: "#c62828"
    stroke-dash: 5
    stroke-width: 2
  }
}

# Layer labels (legend)
labels: {
  direction: down

  l1: Hardware {
    shape: text
    style: {
      font-size: 12
      italic: true
      font-color: "#607d8b"
    }
  }
  l2: Authentication {
    shape: text
    style: {
      font-size: 12
      italic: true
      font-color: "#1565c0"
    }
  }
  l3: Network {
    shape: text
    style: {
      font-size: 12
      italic: true
      font-color: "#388e3c"
    }
  }
  l4: Targets {
    shape: text
    style: {
      font-size: 12
      italic: true
      font-color: "#e65100"
    }
  }
}
