# =============================================================================
# EAP-TLS Certificate Chain
# Architectus Linux Documentation
# =============================================================================

direction: down

title: {
  label: "EAP-TLS\nCertificate Chain"
  near: top-center
  shape: text
  style: {
    font-size: 28
    bold: true
    font-color: "#50fa7b"
  }
}

# =============================================================================
# PKI HIERARCHY
# =============================================================================

pki: "PKI HIERARCHY" {
  style: {
    fill: "#0a1a0a"
    stroke: "#50fa7b"
    stroke-width: 4
    font-color: "#50fa7b"
    font-size: 18
    bold: true
  }

  root: {
    label: "Root CA\n\nOffline - Air-gapped\nValidity: 10-20 years\nTrust Anchor"
    shape: hexagon
    style: {
      fill: "#1a0a0a"
      stroke: "#ff6b6b"
      stroke-width: 4
      font-color: "#ff6b6b"
      font-size: 14
      bold: true
    }
  }

  intermediate: {
    label: "Intermediate CA\n\nIssuing CA\nValidity: 5-10 years\nCRL Distribution"
    shape: hexagon
    style: {
      fill: "#2d2d1a"
      stroke: "#f5a623"
      stroke-width: 3
      font-color: "#f5a623"
      font-size: 14
    }
  }

  root -> intermediate: "Signs" {
    style: {
      stroke: "#ff6b6b"
      stroke-width: 3
    }
  }
}

# =============================================================================
# ENDPOINT CERTIFICATES
# =============================================================================

certs: "ENDPOINT CERTIFICATES" {
  style: {
    fill: "#0a1628"
    stroke: "#89b4fa"
    stroke-width: 3
    font-color: "#89b4fa"
    font-size: 18
    bold: true
  }

  server: {
    label: "Server Certificate\n\nRADIUS Server FQDN\nEKU: id-kp-serverAuth\nKey Usage: Digital Signature"
    shape: hexagon
    style: {
      fill: "#2a1a3a"
      stroke: "#cba6f7"
      stroke-width: 3
      font-color: "#ffffff"
      font-size: 14
    }
  }

  client: {
    label: "Client Certificate\n\nEndpoint Identity\nEKU: id-kp-clientAuth\nKey Usage: Digital Signature"
    shape: hexagon
    style: {
      fill: "#1a1a3a"
      stroke: "#89b4fa"
      stroke-width: 3
      font-color: "#ffffff"
      font-size: 14
    }
  }
}

pki.intermediate -> certs.server: "Issues" {
  style: {
    stroke: "#f5a623"
    stroke-width: 2
  }
}

pki.intermediate -> certs.client: "Issues" {
  style: {
    stroke: "#f5a623"
    stroke-width: 2
  }
}

# =============================================================================
# TRUST ENDPOINTS
# =============================================================================

trust: "MUTUAL AUTHENTICATION" {
  style: {
    fill: "#0a2a2a"
    stroke: "#94e2d5"
    stroke-width: 3
    font-color: "#94e2d5"
    font-size: 18
    bold: true
  }

  radius: {
    label: "RADIUS Server\n\nValidates Client Cert\nTrusts CA Chain\nPolicy Enforcement"
    shape: hexagon
    style: {
      fill: "#2a1a3a"
      stroke: "#cba6f7"
      stroke-width: 3
      font-color: "#ffffff"
      font-size: 14
    }
  }

  linux: {
    label: "Linux Client\n\nValidates Server Cert\nTrusts CA Chain\nNetworkManager"
    shape: hexagon
    style: {
      fill: "#1a1a3a"
      stroke: "#89b4fa"
      stroke-width: 3
      font-color: "#ffffff"
      font-size: 14
    }
  }

  radius <-> linux: "Mutual TLS" {
    style: {
      stroke: "#50fa7b"
      stroke-width: 4
    }
  }
}

certs.server -> trust.radius: "Installed" {
  style: {
    stroke: "#cba6f7"
    stroke-dash: 4
  }
}

certs.client -> trust.linux: "Installed" {
  style: {
    stroke: "#89b4fa"
    stroke-dash: 4
  }
}
