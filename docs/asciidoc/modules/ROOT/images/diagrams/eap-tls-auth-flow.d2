# =============================================================================
# 802.1X EAP-TLS Authentication Flow
# Architectus Linux Documentation
# =============================================================================

direction: right

title: {
  label: "802.1X EAP-TLS\nAuthentication Flow"
  near: top-center
  shape: text
  style: {
    font-size: 28
    bold: true
    font-color: "#50fa7b"
  }
}

# =============================================================================
# SUPPLICANT
# =============================================================================

supplicant: "SUPPLICANT" {
  style: {
    fill: "#0a0a2a"
    stroke: "#89b4fa"
    stroke-width: 3
    font-color: "#89b4fa"
    font-size: 18
    bold: true
  }

  client: {
    label: "Linux Client\n\nNetworkManager\nClient Certificate\nPrivate Key"
    shape: hexagon
    style: {
      fill: "#1a1a3a"
      stroke: "#89b4fa"
      stroke-width: 3
      font-color: "#ffffff"
      font-size: 14
    }
  }
}

# =============================================================================
# AUTHENTICATOR
# =============================================================================

authenticator: "AUTHENTICATOR" {
  style: {
    fill: "#1a1a0a"
    stroke: "#f5a623"
    stroke-width: 3
    font-color: "#f5a623"
    font-size: 18
    bold: true
  }

  switch: {
    label: "Network Switch\n\n802.1X Port Control\nEAPOL â†” RADIUS\nVLAN Assignment"
    shape: hexagon
    style: {
      fill: "#2d2d1a"
      stroke: "#f5a623"
      stroke-width: 3
      font-color: "#ffffff"
      font-size: 14
    }
  }
}

# =============================================================================
# AUTHENTICATION SERVER
# =============================================================================

radius: "AUTH SERVER" {
  style: {
    fill: "#1a0a1a"
    stroke: "#cba6f7"
    stroke-width: 3
    font-color: "#cba6f7"
    font-size: 18
    bold: true
  }

  ise: {
    label: "RADIUS / ISE\n\nEAP-TLS Validation\nCertificate Chain\nPolicy Engine\nAuthorization"
    shape: hexagon
    style: {
      fill: "#2a1a3a"
      stroke: "#cba6f7"
      stroke-width: 3
      font-color: "#ffffff"
      font-size: 14
    }
  }
}

# =============================================================================
# CONNECTIONS
# =============================================================================

supplicant.client -> authenticator.switch: "EAPOL\n(Layer 2)" {
  style: {
    stroke: "#89b4fa"
    stroke-width: 4
  }
}

authenticator.switch -> radius.ise: "RADIUS\n(UDP 1812)" {
  style: {
    stroke: "#cba6f7"
    stroke-width: 4
  }
}

# =============================================================================
# AUTHENTICATION SEQUENCE
# =============================================================================

sequence: "AUTHENTICATION SEQUENCE" {
  style: {
    fill: "#0a1628"
    stroke: "#50fa7b"
    stroke-width: 3
    font-color: "#50fa7b"
    font-size: 16
    bold: true
  }

  s1: {
    label: "1. EAPOL-Start"
    shape: rectangle
    style: {
      fill: "#1a1a3a"
      stroke: "#89b4fa"
      stroke-width: 2
      font-color: "#89b4fa"
      font-size: 12
    }
  }

  s2: {
    label: "2. EAP-Request/Identity"
    shape: rectangle
    style: {
      fill: "#2d2d1a"
      stroke: "#f5a623"
      stroke-width: 2
      font-color: "#f5a623"
      font-size: 12
    }
  }

  s3: {
    label: "3. EAP-Response/Identity"
    shape: rectangle
    style: {
      fill: "#1a1a3a"
      stroke: "#89b4fa"
      stroke-width: 2
      font-color: "#89b4fa"
      font-size: 12
    }
  }

  s4: {
    label: "4. RADIUS Access-Request"
    shape: rectangle
    style: {
      fill: "#2d2d1a"
      stroke: "#f5a623"
      stroke-width: 2
      font-color: "#f5a623"
      font-size: 12
    }
  }

  s5: {
    label: "5. TLS Handshake + Certs"
    shape: rectangle
    style: {
      fill: "#2a1a3a"
      stroke: "#cba6f7"
      stroke-width: 2
      font-color: "#cba6f7"
      font-size: 12
    }
  }

  s6: {
    label: "6. Access-Accept + VLAN"
    shape: rectangle
    style: {
      fill: "#1a3a1a"
      stroke: "#50fa7b"
      stroke-width: 2
      font-color: "#50fa7b"
      font-size: 12
    }
  }

  s7: {
    label: "7. EAP-Success"
    shape: rectangle
    style: {
      fill: "#1a3a1a"
      stroke: "#50fa7b"
      stroke-width: 2
      font-color: "#50fa7b"
      font-size: 12
    }
  }

  s1 -> s2 -> s3 -> s4 -> s5 -> s6 -> s7 {
    style: {
      stroke: "#50fa7b"
      stroke-width: 2
    }
  }
}

# =============================================================================
# RESULT
# =============================================================================

result: {
  label: "PORT AUTHORIZED\n\nVLAN Assigned\nACL Applied\nNetwork Access"
  shape: hexagon
  style: {
    fill: "#1a3a1a"
    stroke: "#50fa7b"
    stroke-width: 4
    font-color: "#50fa7b"
    font-size: 14
    bold: true
  }
}

sequence -> result: "Success" {
  style: {
    stroke: "#50fa7b"
    stroke-width: 3
  }
}
